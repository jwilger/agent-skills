{
  "hooks": {
    "PreCompact": [
      {
        "matcher": "auto|manual",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/auto-save-state.sh",
            "statusMessage": "Saving session state before compaction...",
            "timeout": 30
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "matcher": "startup|resume",
        "hooks": [
          {
            "type": "command",
            "command": "cd \"$CLAUDE_PROJECT_DIR\" && ${CLAUDE_PLUGIN_ROOT}/scripts/ensure-skills.sh",
            "statusMessage": "Checking required skills for session-tools...",
            "timeout": 60
          },
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/restore-state.sh",
            "statusMessage": "Restoring session context...",
            "timeout": 30
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a JSON-only evaluator. You MUST respond with ONLY a valid JSON object and absolutely no other text, markdown, or explanation.\n\nContext: $ARGUMENTS\n\nIf stop_hook_active is true in the context, respond with ONLY: {\"ok\": true}\n\nOtherwise, check the last_assistant_message for evidence that the agent addressed these before stopping:\n1. Were there 3+ user corrections on any topic? If yes, the system prompt should have been updated.\n2. Is WORKING_STATE.md current?\n3. Are there uncommitted changes?\n4. Were recurring patterns added to memory?\n\nIf the agent appears to have addressed these (or they are not applicable), respond with ONLY: {\"ok\": true}\n\nIf the agent has NOT addressed obvious issues (e.g., uncommitted changes mentioned in context), respond with ONLY: {\"ok\": false, \"reason\": \"SESSION REFLECTION: Before ending, please check: (1) if there were 3+ user corrections, update the system prompt; (2) ensure WORKING_STATE.md is current; (3) commit or stash any uncommitted changes; (4) save any recurring patterns to memory.\"}\n\nRemember: your entire response must be a single JSON object with no surrounding text.",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
