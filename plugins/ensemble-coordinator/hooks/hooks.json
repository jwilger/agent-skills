{
  "hooks": {
    "SessionStart": [
      {
        "matcher": "startup|resume",
        "hooks": [
          {
            "type": "command",
            "command": "cd \"$CLAUDE_PROJECT_DIR\" && ${CLAUDE_PLUGIN_ROOT}/scripts/ensure-skills.sh",
            "statusMessage": "Checking required skills for ensemble-coordinator...",
            "timeout": 60
          },
          {
            "type": "command",
            "command": "cd \"$CLAUDE_PROJECT_DIR\" && if [ -f .team/coordinator-instructions.md ]; then echo '{\"systemMessage\": \"Ensemble team detected. Read .team/coordinator-instructions.md before taking any action. You are the coordinator — you facilitate, you do not implement. You MUST activate the team via TeamCreate before any work begins. Edit, Write, Task, and Bash are ALL blocked until the team is active. Do NOT spawn anonymous Task agents — use TeamCreate with named team members from .team/ profiles.\"}'; else echo '{}'; fi",
            "timeout": 10
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Edit|Write|NotebookEdit|Task|Bash",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/enforce-coordinator-role.sh",
            "timeout": 10
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "TeamCreate",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/mark-team-active.sh",
            "timeout": 10
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "cd \"$CLAUDE_PROJECT_DIR\" && LAST_COMMIT=$(git log --oneline -1 2>/dev/null | head -1); if echo \"$LAST_COMMIT\" | grep -qiE '(merge|squash)'; then echo '{\"hookSpecificOutput\": {\"hookEventName\": \"PostToolUse\", \"additionalContext\": \"A merge/commit just happened. If an ensemble team is active, the team should run a mini-retro before starting new work. The coordinator facilitates but does NOT run the retro itself — the team members discuss.\"}}'; else echo '{}'; fi",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
